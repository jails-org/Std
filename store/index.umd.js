(function(i,c){typeof exports=="object"&&typeof module!="undefined"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(i=typeof globalThis!="undefined"?globalThis:i||self,c(i.store={}))})(this,function(i){"use strict";function c(a,u){let s=[];const l=new Set,d=b(a),f=()=>d,p=e=>{if(e.call)return l.add(e),()=>{l.delete(e)};{const o=(t,{action:n,payload:r})=>{n in e&&e[n].call(null,t,{action:n,payload:r})};return l.add(o),()=>{l.delete(o)}}},y=(e,o)=>(s.push({action:e,payload:o}),new Promise(t=>S({action:e,payload:o},t))),h=e=>new Promise(o=>{p((t,{action:n,payload:r})=>{n in e&&m(g=>{e[n].call(null,t,{action:n,payload:r}),o(t)})})}),S=({action:e,payload:o={}},t)=>{s.forEach(({action:n,payload:r={}})=>{if(!(n in u))console.log(`[Oni] Error -> No action [ ${n} ] found.`);else{const g=u[n].call(null,d,r,{getState:f,subscribe:p,dispatch:y,patternMatch:h});Object.assign(d,g)}}),s.length&&(l.forEach(n=>n(d,{action:e,payload:o})),s=[]),t(d)};return{getState:f,subscribe:p,dispatch:y,patternMatch:h,destroy:()=>l.clear()}}const b=a=>JSON.parse(JSON.stringify(a)),m=typeof window>"u"?a=>a():a=>requestAnimationFrame(a);i.Store=c,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
