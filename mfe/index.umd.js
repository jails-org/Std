(function(t,e){typeof exports=="object"&&typeof module!="undefined"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(t=typeof globalThis!="undefined"?globalThis:t||self,e(t.mfe={}))})(this,function(t){"use strict";var P=Object.defineProperty;var A=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var E=(t,e,n)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_=(t,e)=>{for(var n in e||(e={}))H.call(e,n)&&E(t,n,e[n]);if(A)for(var n of A(e))k.call(e,n)&&E(t,n,e[n]);return t};var b=(t,e,n)=>new Promise((p,d)=>{var i=r=>{try{o(n.next(r))}catch(a){d(a)}},w=r=>{try{o(n.throw(r))}catch(a){d(a)}},o=r=>r.done?p(r.value):Promise.resolve(r.value).then(i,w);o((n=n.apply(t,e)).next())});const e=({timeout:d=5e3}={})=>{const i={};return{renderJS({target:o,tag:r,src:a}){return o.innerHTML=`<${r}></${r}>`,new Promise((y,u)=>{const h=document.createElement("script");h.src=a,h.async=!0,h.onload=()=>y(o),h.onerror=S=>u({type:"error",message:`[mfe] - ${S.type} loading script`}),document.head.appendChild(h)})},render(o,r){return b(this,null,function*(){if(!o)return new Promise((a,y)=>{throw{type:"not-found",data:{target:o,path},message:"[mfe] - Target not found"}});if(i[r])i[r].push({target:o});else{i[r]=[];const a=yield fetch(r).then(s=>s.text()),u=new DOMParser().parseFromString(a,"text/html"),h=u.querySelectorAll('link[rel="stylesheet"], style'),S=u.querySelectorAll("script"),T=new URL(r),L=[];h.forEach(s=>{switch(s.localName){case"link":const l=document.createElement("link");l.setAttribute("rel","stylesheet"),l.setAttribute("href",new URL(s.getAttribute("href")||"",T).href),L.push(new Promise((c,f)=>{l.onload=()=>c(!0),l.onerror=()=>f(new Error(`Failed to load ${l.href}`))})),document.head.appendChild(l);break;case"style":const m=document.createElement("style");m.innerHTML=s.innerHTML,document.head.appendChild(m);break}});const M=[];return S.forEach(s=>{M.push(()=>new Promise((l,m)=>{const c=document.createElement("script");for(const f of s.attributes)c.setAttribute(f.name,f.value);if(s.text){c.text=s.text,document.head.appendChild(c),l();return}s.src&&(c.setAttribute("src",new URL(s.getAttribute("src")||"",T).href),c.onload=l,c.onerror=m,document.head.appendChild(c))}))}),new Promise(s=>{Promise.allSettled(L).then(()=>o.innerHTML=u.body.innerHTML).then(()=>p(M)).then(()=>setTimeout(s,1e3)).then(()=>i[r].forEach(({target:l})=>l.innerHTML=u.body.innerHTML))})}})}}},n=(d={})=>window.___Shell___?(window.___Shell___=_(_({},d),window.___Shell___),window.___Shell___):(window.___Shell___=_({},d),window.___Shell___),p=d=>b(this,null,function*(){const i=[];for(const w of d){const o=yield w();i.push(o)}return i});t.Shell=n,t.mfe=e,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});
