(function(L,k){typeof exports=="object"&&typeof module!="undefined"?k(exports):typeof define=="function"&&define.amd?define(["exports"],k):(L=typeof globalThis!="undefined"?globalThis:L||self,k(L.outlet={}))})(this,function(L){"use strict";var k=function(){const h=()=>{},S={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:h,afterNodeAdded:h,beforeNodeMorphed:h,afterNodeMorphed:h,beforeNodeRemoved:h,afterNodeRemoved:h,beforeAttributeUpdated:h},head:{style:"merge",shouldPreserve:c=>c.getAttribute("im-preserve")==="true",shouldReAppend:c=>c.getAttribute("im-re-append")==="true",shouldRemove:h,afterHeadMorphed:h},restoreFocus:!0};function b(c,p,l={}){c=N(c);const f=B(p),d=I(c,f,l),a=g(d,()=>T(d,c,f,r=>r.morphStyle==="innerHTML"?(y(r,c,f),Array.from(c.childNodes)):M(r,c,f)));return d.pantry.remove(),a}function M(c,p,l){const f=B(p);let d=Array.from(f.childNodes);const a=d.indexOf(p),r=d.length-(a+1);return y(c,f,l,p,p.nextSibling),d=Array.from(f.childNodes),d.slice(a,d.length-r)}function g(c,p){var n;if(!c.config.restoreFocus)return p();let l=document.activeElement;if(!(l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement))return p();const{id:f,selectionStart:d,selectionEnd:a}=l,r=p();return f&&f!==((n=document.activeElement)==null?void 0:n.id)&&(l=c.target.querySelector(`#${f}`),l==null||l.focus()),l&&!l.selectionEnd&&a&&l.setSelectionRange(d,a),r}const y=function(){function c(e,t,o,i=null,s=null){t instanceof HTMLTemplateElement&&o instanceof HTMLTemplateElement&&(t=t.content,o=o.content),i||(i=t.firstChild);for(const u of o.childNodes){if(i&&i!=s){const m=l(e,u,i,s);if(m){m!==i&&d(e,i,m),H(m,u,e),i=m.nextSibling;continue}}if(u instanceof Element&&e.persistentIds.has(u.id)){const m=a(t,u.id,i,e);H(m,u,e),i=m.nextSibling;continue}const v=p(t,u,i,e);v&&(i=v.nextSibling)}for(;i&&i!=s;){const u=i;i=i.nextSibling,f(e,u)}}function p(e,t,o,i){if(i.callbacks.beforeNodeAdded(t)===!1)return null;if(i.idMap.has(t)){const s=document.createElement(t.tagName);return e.insertBefore(s,o),H(s,t,i),i.callbacks.afterNodeAdded(s),s}else{const s=document.importNode(t,!0);return e.insertBefore(s,o),i.callbacks.afterNodeAdded(s),s}}const l=function(){function e(i,s,u,v){let m=null,E=s.nextSibling,V=0,A=u;for(;A&&A!=v;){if(o(A,s)){if(t(i,A,s))return A;m===null&&(i.idMap.has(A)||(m=A))}if(m===null&&E&&o(A,E)&&(V++,E=E.nextSibling,V>=2&&(m=void 0)),A.contains(document.activeElement))break;A=A.nextSibling}return m||null}function t(i,s,u){let v=i.idMap.get(s),m=i.idMap.get(u);if(!m||!v)return!1;for(const E of v)if(m.has(E))return!0;return!1}function o(i,s){const u=i,v=s;return u.nodeType===v.nodeType&&u.tagName===v.tagName&&(!u.id||u.id===v.id)}return e}();function f(e,t){var o;if(e.idMap.has(t))n(e.pantry,t,null);else{if(e.callbacks.beforeNodeRemoved(t)===!1)return;(o=t.parentNode)==null||o.removeChild(t),e.callbacks.afterNodeRemoved(t)}}function d(e,t,o){let i=t;for(;i&&i!==o;){let s=i;i=i.nextSibling,f(e,s)}return i}function a(e,t,o,i){const s=i.target.querySelector(`#${t}`)||i.pantry.querySelector(`#${t}`);return r(s,i),n(e,s,o),s}function r(e,t){const o=e.id;for(;e=e.parentNode;){let i=t.idMap.get(e);i&&(i.delete(o),i.size||t.idMap.delete(e))}}function n(e,t,o){if(e.moveBefore)try{e.moveBefore(t,o)}catch(i){e.insertBefore(t,o)}else e.insertBefore(t,o)}return c}(),H=function(){function c(r,n,e){return e.ignoreActive&&r===document.activeElement?null:(e.callbacks.beforeNodeMorphed(r,n)===!1||(r instanceof HTMLHeadElement&&e.head.ignore||(r instanceof HTMLHeadElement&&e.head.style!=="morph"?R(r,n,e):(p(r,n,e),a(r,e)||y(e,r,n))),e.callbacks.afterNodeMorphed(r,n)),r)}function p(r,n,e){let t=n.nodeType;if(t===1){const o=r,i=n,s=o.attributes,u=i.attributes;for(const v of u)d(v.name,o,"update",e)||o.getAttribute(v.name)!==v.value&&o.setAttribute(v.name,v.value);for(let v=s.length-1;0<=v;v--){const m=s[v];if(m&&!i.hasAttribute(m.name)){if(d(m.name,o,"remove",e))continue;o.removeAttribute(m.name)}}a(o,e)||l(o,i,e)}(t===8||t===3)&&r.nodeValue!==n.nodeValue&&(r.nodeValue=n.nodeValue)}function l(r,n,e){if(r instanceof HTMLInputElement&&n instanceof HTMLInputElement&&n.type!=="file"){let t=n.value,o=r.value;f(r,n,"checked",e),f(r,n,"disabled",e),n.hasAttribute("value")?o!==t&&(d("value",r,"update",e)||(r.setAttribute("value",t),r.value=t)):d("value",r,"remove",e)||(r.value="",r.removeAttribute("value"))}else if(r instanceof HTMLOptionElement&&n instanceof HTMLOptionElement)f(r,n,"selected",e);else if(r instanceof HTMLTextAreaElement&&n instanceof HTMLTextAreaElement){let t=n.value,o=r.value;if(d("value",r,"update",e))return;t!==o&&(r.value=t),r.firstChild&&r.firstChild.nodeValue!==t&&(r.firstChild.nodeValue=t)}}function f(r,n,e,t){const o=n[e],i=r[e];if(o!==i){const s=d(e,r,"update",t);s||(r[e]=n[e]),o?s||r.setAttribute(e,""):d(e,r,"remove",t)||r.removeAttribute(e)}}function d(r,n,e,t){return r==="value"&&t.ignoreActiveValue&&n===document.activeElement?!0:t.callbacks.beforeAttributeUpdated(r,n,e)===!1}function a(r,n){return!!n.ignoreActiveValue&&r===document.activeElement&&r!==document.body}return c}();function T(c,p,l,f){if(c.head.block){const d=p.querySelector("head"),a=l.querySelector("head");if(d&&a){const r=R(d,a,c);return Promise.all(r).then(()=>{const n=Object.assign(c,{head:{block:!1,ignore:!0}});return f(n)})}}return f(c)}function R(c,p,l){let f=[],d=[],a=[],r=[],n=new Map;for(const t of p.children)n.set(t.outerHTML,t);for(const t of c.children){let o=n.has(t.outerHTML),i=l.head.shouldReAppend(t),s=l.head.shouldPreserve(t);o||s?i?d.push(t):(n.delete(t.outerHTML),a.push(t)):l.head.style==="append"?i&&(d.push(t),r.push(t)):l.head.shouldRemove(t)!==!1&&d.push(t)}r.push(...n.values());let e=[];for(const t of r){let o=document.createRange().createContextualFragment(t.outerHTML).firstChild;if(l.callbacks.beforeNodeAdded(o)!==!1){if("href"in o&&o.href||"src"in o&&o.src){let i,s=new Promise(function(u){i=u});o.addEventListener("load",function(){i()}),e.push(s)}c.appendChild(o),l.callbacks.afterNodeAdded(o),f.push(o)}}for(const t of d)l.callbacks.beforeNodeRemoved(t)!==!1&&(c.removeChild(t),l.callbacks.afterNodeRemoved(t));return l.head.afterHeadMorphed(c,{added:f,kept:a,removed:d}),e}const I=function(){function c(n,e,t){const{persistentIds:o,idMap:i}=a(n,e),s=p(t),u=s.morphStyle||"outerHTML";if(!["innerHTML","outerHTML"].includes(u))throw`Do not understand how to morph style ${u}`;return{target:n,newContent:e,config:s,morphStyle:u,ignoreActive:s.ignoreActive,ignoreActiveValue:s.ignoreActiveValue,restoreFocus:s.restoreFocus,idMap:i,persistentIds:o,pantry:l(),callbacks:s.callbacks,head:s.head}}function p(n){let e=Object.assign({},S);return Object.assign(e,n),e.callbacks=Object.assign({},S.callbacks,n.callbacks),e.head=Object.assign({},S.head,n.head),e}function l(){const n=document.createElement("div");return n.hidden=!0,document.body.insertAdjacentElement("afterend",n),n}function f(n){let e=Array.from(n.querySelectorAll("[id]"));return n.id&&e.push(n),e}function d(n,e,t,o){for(const i of o)if(e.has(i.id)){let s=i;for(;s;){let u=n.get(s);if(u==null&&(u=new Set,n.set(s,u)),u.add(i.id),s===t)break;s=s.parentElement}}}function a(n,e){const t=f(n),o=f(e),i=r(t,o);let s=new Map;d(s,i,n,t);const u=e.__idiomorphRoot||e;return d(s,i,u,o),{persistentIds:i,idMap:s}}function r(n,e){let t=new Set,o=new Map;for(const{id:s,tagName:u}of n)o.has(s)?t.add(s):o.set(s,u);let i=new Set;for(const{id:s,tagName:u}of e)i.has(s)?t.add(s):o.get(s)===u&&i.add(s);for(const s of t)i.delete(s);return i}return c}(),{normalizeElement:N,normalizeParent:B}=function(){const c=new WeakSet;function p(a){return a instanceof Document?a.documentElement:a}function l(a){if(a==null)return document.createElement("div");if(typeof a=="string")return l(d(a));if(c.has(a))return a;if(a instanceof Node){if(a.parentNode)return f(a);{const r=document.createElement("div");return r.append(a),r}}else{const r=document.createElement("div");for(const n of[...a])r.append(n);return r}}function f(a){return{childNodes:[a],querySelectorAll:r=>{const n=a.querySelectorAll(r);return a.matches(r)?[a,...n]:n},insertBefore:(r,n)=>a.parentNode.insertBefore(r,n),moveBefore:(r,n)=>a.parentNode.moveBefore(r,n),get __idiomorphRoot(){return a}}}function d(a){let r=new DOMParser,n=a.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(n.match(/<\/html>/)||n.match(/<\/head>/)||n.match(/<\/body>/)){let e=r.parseFromString(a,"text/html");if(n.match(/<\/html>/))return c.add(e),e;{let t=e.firstChild;return t&&c.add(t),t}}else{let t=r.parseFromString("<body><template>"+a+"</template></body>","text/html").body.querySelector("template").content;return c.add(t),t}}return{normalizeElement:p,normalizeParent:l}}();return{morph:b,defaults:S}}();const O=({target:h})=>{q();const S=document.head.cloneNode(!0),b=h.innerHTML;return{renderJS(M,g){if(!g&&!M){const y='script[name="outlet-script"]';return h.innerHTML=b,document.head.querySelector(y).remove(),Promise.resolve(h)}return h.innerHTML=`<${M}></${M}>`,new Promise((y,H)=>{const T=document.createElement("script");T.setAttribute("name","outlet-script"),T.src=g,T.onload=()=>y(h),T.onerror=H,document.head.appendChild(T)}).catch(y=>{throw"TypeError: Failed to fetch"})},render(M){return M?fetch(M).then(g=>g.text()).then(g=>{const y=[],H=new URL(M),R=new DOMParser().parseFromString(g,"text/html"),I=R.documentElement.querySelector("body"),N=I.querySelectorAll("script, link, style"),B=R.documentElement.querySelector("head");return N.forEach(c=>{B.appendChild(c)}),k.morph(document.head,B,{callbacks:{beforeNodeAdded:F(y,H)}}),new Promise(c=>{h.innerHTML=I==null?void 0:I.innerHTML,Promise.allSettled(y).then(()=>c(h))})}).catch(g=>{throw g}):(k.morph(document.head,S),h.innerHTML=b,Promise.resolve(h))}}},q=()=>{document.head.querySelectorAll("script, link, style").forEach(h=>h.setAttribute("im-preserve","true"))},F=(h,S)=>b=>{if(b.src&&b.getAttribute("src").startsWith("/")){const{pathname:M,search:g}=new URL(b.src);b.src=S.origin+M+g}else if(b.href&&b.getAttribute("href").startsWith("/")){const{pathname:M,search:g}=new URL(b.href);b.href=S.origin+M+g}return b.src&&b.localName=="script"&&h.push(new Promise((M,g)=>{b.addEventListener("load",M),b.addEventListener("error",g)})),h};L.Outlet=O,Object.defineProperty(L,Symbol.toStringTag,{value:"Module"})});
