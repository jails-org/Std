(function(a,i){typeof exports=="object"&&typeof module!="undefined"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(a=typeof globalThis!="undefined"?globalThis:a||self,i(a.store={}))})(this,function(a){"use strict";function i(o,b){let r=[];const d=new Set,c=S(o),h=()=>c,u=e=>e.call?(d.add(e),()=>{d.delete(e)}):()=>{f(e).then(({__unsubscribe:n})=>n())},g=(e,n)=>(r.push({action:e,payload:n}),new Promise(s=>y(t=>m({action:e,payload:n},s)))),f=e=>new Promise(n=>{let s=u((t,{action:l,payload:p})=>{l in e&&y(w=>{e[l].call(null,t,{action:l,payload:p}),t.__unsubscribe=s,n(t)})})}),m=({action:e,payload:n={}},s)=>{r.forEach(({action:t,payload:l={}})=>{if(!(t in b))console.log(`[Oni] Error -> No action [ ${t} ] found.`);else{const p=b[t].call(null,c,l,{getState:h,subscribe:u,dispatch:g,patternMatch:f});Object.assign(c,p)}}),r.length&&(d.forEach(t=>t(c,{action:e,payload:n})),r=[]),s(c)};return{getState:h,subscribe:u,dispatch:g,patternMatch:f,destroy:()=>d.clear()}}const S=o=>JSON.parse(JSON.stringify(o)),y=typeof window>"u"?o=>o():o=>requestAnimationFrame(o);a.Store=i,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
