(function(o,m){typeof exports=="object"&&typeof module!="undefined"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(o=typeof globalThis!="undefined"?globalThis:o||self,m(o.mfe={}))})(this,function(o){"use strict";const m=({timeout:e=5e3}={})=>{const l={};return{renderJS({target:n,tag:s,src:t}){return n.innerHTML=`<${s}></${s}>`,new Promise((r,i)=>{const a=document.createElement("script");a.src=t,a.async=!0,a.onload=()=>r(n),a.onerror=u=>i({type:"error",message:`[mfe] - ${u.type} loading script`}),document.head.appendChild(a)})},render(n,s){return fetch(s).then(t=>t.text()).then(t=>{const r=[],i=new URL(s),u=new DOMParser().parseFromString(t,"text/html"),h=u.documentElement.querySelector("body");if(!l[s]){const d=h.querySelectorAll('script, link[rel="stylesheet"], style'),f=u.documentElement.querySelector("head");d.forEach(c=>{f.appendChild(c)}),f.querySelectorAll('link[rel="stylesheet"], style, script').forEach(c=>{if(c.localName=="script"&&c.src){const p=document.createElement("script");p.setAttribute("type","module"),p.setAttribute("src",c.getAttribute("src")),y(p,i,r,e),document.head.appendChild(p)}else y(c,i,r,e),document.head.appendChild(c)}),l[s]=r}return new Promise((d,f)=>{Promise.all(l[s]).then(()=>{n.innerHTML=h==null?void 0:h.innerHTML,d(n)}).catch(c=>{f({type:"error",message:"[mfe] - Unexpected error : "+c})})})}).catch(t=>{throw t})}}},y=(e,l,n,s)=>{if(e.src&&e.getAttribute("src").startsWith("/")){const{pathname:t,search:r}=new URL(e.src);e.src=l.origin+t+r}else if(e.href&&e.getAttribute("href").startsWith("/")){const{pathname:t,search:r}=new URL(e.href);e.href=l.origin+t+r}return(e.src||e.href&&e.rel=="stylesheet")&&n.push(new Promise((t,r)=>{const i=setTimeout(()=>{r({type:"error",message:`[mfe] - Timeout exceeded ${e} resolving after milisseconds.`})},s);e.addEventListener("load",()=>{clearTimeout(i),t(e)}),e.addEventListener("error",()=>{clearTimeout(i),r({type:"error",message:`[mfe] - Error to fetch : ${e.src}`})})})),n};o.mfe=m,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
